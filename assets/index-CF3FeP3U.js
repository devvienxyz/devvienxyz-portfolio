const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Menu-C8PnCAS5.js","assets/vendor-react-DHpJmzOT.js","assets/vendor-three-DVtzbV9o.js","assets/vendor-misc-C0wpLiRc.js","assets/Backdrops-CO8MG1jx.js"])))=>i.map(i=>d[i]);
import{r as s,j as r,u as y,a as A,c as P,b as L,d as S,O as R,_ as O,C as _,e as M}from"./vendor-react-DHpJmzOT.js";import{v as G,r as T,g as w,w as N}from"./vendor-three-DVtzbV9o.js";import{U as D}from"./vendor-misc-C0wpLiRc.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();function Y(){const e=s.useRef();return r.jsxs(r.Fragment,{children:[r.jsxs("mesh",{ref:e,position:[4,10,-5],children:[r.jsx("sphereGeometry",{args:[2,32,32]}),r.jsx("meshBasicMaterial",{transparent:!0})]}),r.jsx("pointLight",{color:16763904,intensity:200,distance:100,position:[0,15,-5]}),r.jsx("pointLight",{color:16251391,intensity:200,distance:100,position:[4,8,-5]})]})}function v(e){if(Object.freeze(e),Array.isArray(e))for(const t of e)v(t);else if(e&&typeof e=="object")for(const t of Object.values(e))v(t);return e}const j=(e,t,o=!1,i=0)=>[{name:o?"unit-ship-large":"unit-ship",position:[e,.1,t],rotationY:i},{name:"water",position:[e,0,t]}],k=(e,t)=>[{name:"unit-tree",position:[e,0,t-.5],scale:1.5},{name:"unit-tree",position:[e+.6,0,t]},{name:"unit-tree",position:[e,0,t+.6]},{name:"unit-tree",position:[e+.6,0,t+.9],scale:1.5},{name:"unit-tree",position:[e+.1,0,t+.3]}],I=(e,t)=>[{name:"building-walls",position:[e,.2,t]},{name:"dirt",position:[e,.1,t]},{name:"dirt",position:[e,0,t]}],C=v([...k(-3,-5),...j(-3,0,!0,-5),...j(.5,-4.5),...I(1,-1.7),{name:"water",position:[-.5,0,-4.5]},{name:"river-straight",position:[-2,0,0]},{name:"river-corner",position:[-1,0,0]},{name:"river-corner",position:[-.5,0,-.85],rotationY:-135.1},{name:"river-straight",position:[.5,0,-.85],rotationY:0},{name:"river-straight",position:[1.5,0,-.85]},{name:"river-corner",position:[2.5,0,-.85]},{name:"bridge",position:[3,0,-1.7],rotationY:-90.1},{name:"water-rocks",position:[-2.5,0,.9]},{name:"water",position:[.5,0,.9]},{name:"building-mine",position:[1.5,0,-4.6],rotationY:45},{name:"grass-hill",position:[1,0,-3.5]},{name:"building-tower",position:[0,0,-3.5]},{name:"building-mill",position:[-2.5,.2,-2.5],rotationY:45},{name:"building-farm",position:[-3.5,0,-2.5]},{name:"building-archery",position:[-1.5,0,-4.5],rotationY:45},{name:"unit-tower",position:[-4,0,-3.5]},{name:"building-village",position:[-3,0,-3.5],rotationY:45},{name:"stone-mountain",position:[2,0,-3.6]},{name:"building-cabin",position:[2.5,0,-2.7]},{name:"dirt-lumber",position:[2,0,-1.7]},{name:"building-port",position:[-3.5,0,-1],rotationY:90},{name:"building-market",position:[-2.5,0,-1]},{name:"unit-mansion",position:[1,.2,-.5]},{name:"grass-hill",position:[-1.5,0,.9]},{name:"building-dock",position:[-.5,0,.9],rotationY:90},{name:"building-sheep",position:[1,0,0]},{name:"building-castle",position:[2,0,0]},{name:"building-wizard-tower",position:[2,0,1.2],rotationY:0},{name:"unit-mill",position:[.7,0,1.9],rotationY:45},{name:"grass",position:[-4,0,-1.7]},{name:"water",position:[-.5,0,-4.5]},{name:"grass",position:[-1,0,-3.5]},{name:"grass",position:[-2,0,-3.5]},{name:"grass",position:[1.5,0,-2.7]},{name:"path-square-end",position:[1.5,.2,-2.6]},{name:"grass",position:[.5,0,-2.6]},{name:"path-straight",position:[.5,.2,-2.6]},{name:"grass",position:[-.5,0,-2.6]},{name:"path-corner",position:[-.5,.2,-2.6],rotationY:135.1},{name:"grass",position:[-1,0,-1.7]},{name:"path-corner",position:[-1,.2,-1.7]},{name:"grass",position:[-2,0,-1.7]},{name:"path-intersectionF",position:[-2,.2,-1.7]},{name:"grass",position:[-3,0,-1.7]},{name:"path-straight",position:[-2,.2,-1.7]},{name:"path-start",position:[-3,.2,-1.7],rotationY:135.1},{name:"grass",position:[-1.5,0,-2.6]},{name:"grass",position:[0,0,-1.7]},{name:"dirt-lumber",position:[2,0,-1.7]},{name:"grass-forest",position:[-1.5,0,-1]},{name:"grass-forest",position:[-4.5,0,-1]},{name:"grass",position:[2,0,0]},{name:"water-rocks",position:[-2.5,0,.9]},{name:"grass-forest",position:[0,0,0]},{name:"water",position:[.5,0,.9]}]),U=(e,t,o,i,{position:n,scale:a=1,rotationY:u=0})=>{t.current.load(i,c=>{const m=c.scene;if(e.add(m),i.includes("mill")){const d=new T(m),h=c.animations;h.length&&(d.clipAction(h[0]).play(),o.current.push(d))}m.position.set(...n),m.scale.set(a,a,a),m.rotation.y=u},void 0,c=>console.error("Model loading error:",c))};function F({scene:e}){const t=s.useRef(new G),o=s.useRef([]);return s.useEffect(()=>{for(const{name:i,...n}of C)U(e,t,o,`assets/kenney/pixel-map/models/${i}.glb`,n);return()=>{for(const i of o.current)i.stopAllAction();o.current=[]}},[e]),y((i,n)=>{for(const a of o.current)a.update(n)}),null}function z(e,t,o=2,i=()=>{}){return D.to(e.position,{duration:o,x:t.x,y:t.y,z:t.z,onUpdate:()=>{e.lookAt(0,0,0)},ease:"power2.inOut",onStart:()=>{},onComplete:i})}function V(e,t=2,o=()=>{}){const{camera:i}=A();s.useEffect(()=>{if(!i)return;const n=z(i,e,t,o);return()=>{n.kill()}},[i,e,t,o])}const p=Object.freeze({INTRO:"intro",POST_INTRO:"post_intro",LOADING:"loading",PLAYING:"playing",PAUSED:"paused",GAME_OVER:"game_over",MENU:"menu"}),x=P(e=>({gamePhase:p.INTRO,setGamePhase:t=>e(()=>({gamePhase:t})),is:t=>x.getState().gamePhase===t,startGame:()=>e(()=>({state:p.PLAYING})),pauseGame:()=>e(()=>({state:p.PAUSED})),resumeGame:()=>e(()=>({state:p.PLAYING})),gameOver:()=>e(()=>({state:p.GAME_OVER})),backToMenu:()=>e(()=>({state:p.MENU}))})),B=-9.8,W=3,E=.2;function K({onMove:e,onJump:t,actions:o}){const i=s.useRef(new Map),n=s.useRef(new w),a=s.useRef(new w),u=s.useRef(0),c=s.useRef(!0),m=s.useRef(null),d=s.useCallback(l=>{!(o!=null&&o[l])||m.current===l||(m.current&&o[m.current]&&o[m.current].stop(),o[l].reset().fadeIn(.1).play(),m.current=l)},[o]);return s.useEffect(()=>{const l=g=>{i.current.set(g.code,!0),g.code==="Space"&&c.current&&(u.current=W,c.current=!1,d("jump"),t==null||t())},f=g=>i.current.set(g.code,!1);return window.addEventListener("keydown",l),window.addEventListener("keyup",f),()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",f)}},[t,d]),{update:(l,f)=>{n.current.set(0,0,0),i.current.get("KeyW")&&(n.current.z-=1),i.current.get("KeyS")&&(n.current.z+=1),i.current.get("KeyA")&&(n.current.x-=1),i.current.get("KeyD")&&(n.current.x+=1),n.current.normalize(),a.current.copy(n.current).multiplyScalar(l),c.current||(u.current+=B*l,f.y+=u.current*l,f.y<=E&&(f.y=E,u.current=0,c.current=!0)),e&&e(a.current,n.current),c.current?n.current.lengthSq()>0?d("walk"):d("idle"):d("jump")}}}const $=Object.freeze({default:"character-female-e.glb"}),q=.2,Z=.2;function H(){const e=s.useRef(),{nodes:t,materials:o,animations:i}=L(`assets/kenney/characters/Models/GLB format/${$.default}`),{actions:n}=S(i,e),a=K({onMove:(u,c)=>{e.current.position.add(u),e.current.rotation.y=Math.atan2(c.x,c.z)},actions:n});return y((u,c)=>{a.update(c,e.current.position)}),r.jsx("group",{ref:e,position:[0,Z,0],scale:q,children:r.jsx("primitive",{object:t["character-female-e"]})})}const Q={x:.8,y:1,z:5},b={vertexShader:`
    varying vec3 vWorldPosition;
    void main() {
      vec4 worldPosition = modelMatrix * vec4(position, 1.0);
      vWorldPosition = worldPosition.xyz;
      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,fragmentShader:`
    varying vec3 vWorldPosition;
    void main() {
      vec3 viewDir = normalize(vWorldPosition);
      float gradient = viewDir.y * 1.0;
      // float gradient = viewDir.y * 0.4 + 0.1;  // lighter effect
      vec3 topColor = vec3(0.988, 0.992, 1.0); // rgb(253, 254, 255) or #fdfefe
      vec3 bottomColor = vec3(0.0, 0.025, 0.142); // rgb(0, 6, 36) or #000624
      vec3 color = mix(bottomColor, topColor, gradient);
      gl_FragColor = vec4(color, 1.0);
    }
  `},X=()=>{const e=s.useRef();return r.jsxs("mesh",{scale:[50,50,50],children:[r.jsx("sphereGeometry",{args:[1,32,32]}),r.jsx("shaderMaterial",{ref:e,vertexShader:b.vertexShader,fragmentShader:b.fragmentShader,side:N})]})};function J(){return r.jsxs(r.Fragment,{children:[r.jsx("directionalLight",{position:[2,2,5],intensity:1}),r.jsx("ambientLight",{intensity:1.5})]})}function ee(){const{camera:e,scene:t}=A(),o=s.useRef(),i=x(n=>n.setGamePhase);return V(Q,3,()=>{i(p.MENU)}),s.useEffect(()=>{e.position.set(-3,2,5),e.lookAt(0,0,0)},[e]),y(()=>{o.current&&o.current.update()}),r.jsxs(r.Fragment,{children:[r.jsx(J,{}),r.jsx(X,{}),r.jsx(Y,{scene:t}),r.jsx(R,{ref:o,enableDamping:!0,enablePan:!0,screenSpacePanning:!1,keyPanSpeed:100,maxDistance:10,minDistance:2,maxPolarAngle:Math.PI/2}),r.jsx(F,{scene:t}),r.jsx(H,{})]})}const te=s.lazy(()=>O(()=>import("./Menu-C8PnCAS5.js"),__vite__mapDeps([0,1,2,3]))),ne=s.lazy(()=>O(()=>import("./Backdrops-CO8MG1jx.js"),__vite__mapDeps([4,1,2,3])));function re(){const[e,t]=s.useState(!1);return s.useEffect(()=>{const o=setTimeout(()=>t(!0),800);return()=>clearTimeout(o)},[]),r.jsxs(s.Suspense,{fallback:null,children:[e&&r.jsx(te,{}),r.jsx(ne,{})]})}function oe(){const e=x(o=>o.gamePhase),t=e===p.POST_INTRO||e===p.MENU;return r.jsx("div",{className:"w-full h-screen",children:r.jsxs(_,{camera:{fov:50,near:.1,far:1e3},children:[r.jsx(ee,{}),t&&r.jsx(re,{})]})})}const ie=()=>r.jsx("div",{className:"w-full h-screen",children:r.jsx(oe,{})});M.createRoot(document.getElementById("root")).render(r.jsx(s.StrictMode,{children:r.jsx(ie,{})}));
